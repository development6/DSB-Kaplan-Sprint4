@{
    Layout = null;
}

<!--Kinesiologia-->

<!DOCTYPE html>

<html>
<head runat="server">
    <meta name="viewport" content="width=device-width" />
    <title>Nutrición</title>
    <style type="text/css">
        body {
            font-family: Arial;
            font-size: 10pt;
        }
    </style>

</head>
<body>

    <center>
        <h1>Dashboard</h1>
    </center>

    <h2>Nutrición</h2>

    Paciente:
    <select id="ddlPaciente">
        <option value="11">Andrés Soto Díaz</option>
        <option value="12">Gloria Sepúlveda Romero</option>
        <option value="13">Olga Hernández Rivera</option>
        <option value="14">Patricio Ibáñez Gatica</option>

    </select>
    <table id="rblChartType" border="0">
        <tr>
            <td><input type="radio" name="ChartType" value="1" checked="checked" />Barra</td>
            <td><input type="radio" name="ChartType" value="2" />Lineal</td>
        </tr>
    </table>
    <!--<div id="dvChart" style="width:50%; position:relative;">
    </div>-->


    <table border="0" cellpadding="0" cellspacing="0">

        <tr>
            <td width="700">
                <div id="dvChart">
                </div>

            </td>

        </tr>
    </table>



    <h3>Promedio pacientes nutrición</h3>

    <style>
        .caja {
            font-family: sans-serif;
            font-size: 18px;
            margin: 80px;
        }
    </style>

    Género:
    <select id="ddlGenero">
        <option value="1">Masculino</option>
        <option value="2">Femenino</option>

    </select>
    Controles:
    <select id="ddlControl">
        <option value="4">4</option>
        <option value="5">5</option>

    </select>
    Morbidos:
    <select id="ddlMorbidos">
        <option value="HTA-DMIR">HTA-DMIR</option>
        <option value="HTA-DMNIR-DLP">HTA-DMNIR-DLP</option>
        <option value="HTA">HTA</option>
        <option value="TABACO ACTIVO">TABACO ACTIVO</option>

    </select>
    Fecha:
    <select id="ddlFecha">
        <option value="2018-08-29">2018-08-29</option>
        <option value="2018-10-16">2018-10-16</option>
        <option value="2018-10-19">2018-10-19</option>
        <option value="2018-11-07">2018-11-07</option>

    </select>
    <input id="button" type="button" value="Mostrar" />
    <table id="rblChartType2" border="0">
        <tr>
            <td><input type="radio" name="ChartType2" value="1" checked="checked" />Barra</td>
            <td><input type="radio" name="ChartType2" value="2" />Lineal</td>
        </tr>
    </table>


    <table border="0" cellpadding="0" cellspacing="0">

        <tr>
            <td width="800">
                <div id="dvChart2">
                </div>
                <div id="dvMensaje" align="center"></div>
            </td>

        </tr>
    </table>


    <!--<table border="0" cellpadding="0" cellspacing="0">

        <tr>
            <td>
                Paciente:
                <select id="ddlPaciente">
                    <option value="1">Paciente</option>

                </select>
                <table id="rblChartType" border="0">
                    <tr>
                        <td><input type="radio" name="ChartType" value="1" checked="checked" />Bar</td>
                        <td><input type="radio" name="ChartType" value="2" />Radar</td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <div id="dvChart">
                </div>
            </td>

        </tr>
        <tr></tr>
    </table>-->


    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/excanvas/r3/excanvas.js" type="text/javascript"></script>
    <script src="//cdn.jsdelivr.net/chart.js/0.2/Chart.js" type="text/javascript"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.5/chartjs-plugin-annotation.js"></script>
    <script src="https://cdn.rawgit.com/chartjs/Chart.js/master/samples/utils.js"></script>


    <script type="text/javascript">
        $(function () {
            LoadChart();
            $("#ddlPaciente").bind("change", function () {
                LoadChart();
            });
            $("#rblChartType input").bind("click", function () {
                LoadChart();
            });
        });
        function LoadChart() {
            var chartType = parseInt($("#rblChartType input:checked").val());
            var ingreso = [];
            var egreso = [];
            var datachart = {
                labels: ["KG MUSC", "KG Grasa", "%MG", "Nivel GV", "Indice", "P.Cintura", "Peso", "Talla", "IMC"],
                datasets: [
                    {
                        label: "Ingreso",
                        backgroundColor: "rgba(90,193,208,0.3)",
                        borderColor: "rgba(151,187,205,0.7)",
                        borderWidth: 1,
                        hoverBackgroundColor: "rgba(151,187,205,1)",
                        hoverBorderColor: "rgba(151,187,205,0.5)",
                        data: ingreso
                    },
                    {
                        label: "Egreso",
                        backgroundColor: "rgba(215,220,67,0.3)",
                        borderColor: "rgba(220,220,220,0.7)",
                        borderWidth: 1,
                        hoverBackgroundColor: "rgba(220,220,220,1)",
                        hoverBorderColor: "rgba(220,220,220,0.5)",
                        data: egreso
                    }
                ]
            };
            $.ajax({
                type: "POST",
                url: "/Home/AjaxMethod",
                data: "{Paciente: '" + $("#ddlPaciente").val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "text",
                success: function (response) {
                    $("#dvChart").html("");
                    //$("#dvLegend").html("");
                    //$("#dvTabla").html("");
                    var data = eval(response);
                    //var data = (eval("(" + response.d + ")"));
                    var el = document.createElement('canvas');
                    $("#dvChart")[0].appendChild(el);


                    //window.alert(data);
                    //Fix for IE 8
                    if ($.browser.msie && $.browser.version == "8.0") {
                        G_vmlCanvasManager.initElement(el);
                    }

                    for (var i = 0; i < data.length; i++) {
                        ingreso.push(data[i].value0, data[i].value1, data[i].value2, data[i].value3, data[i].value4, data[i].value5, data[i].value6, data[i].value7, data[i].value8);
                        egreso.push(data[i].value9, data[i].value10, data[i].value11, data[i].value12, data[i].value13, data[i].value14, data[i].value15, data[i].value16, data[i].value17);
                    }

                    //console.log(ingreso);
                    //window.alert(ingreso);

                    var talla = ingreso[7] * ingreso[7];

                    var ctx = el.getContext('2d');
                    var userStrengthsChart;

                    switch (chartType) {
                        case 1:
                            userStrengthsChart = new Chart(ctx, {
                                type: 'bar',
                                data: datachart,
                                options: {
                                    title: {
                                        display: true,
                                        text: "Ergometría"
                                    },
                                    annotation: {
                                        events: ['click', 'dblclick', 'mouseover', 'mouseout'],
                                        annotations: [
                                            {
                                                type: 'line',
                                                mode: 'horizontal',
                                                scaleID: 'y-axis-0',
                                                value: (talla) * 18.5,
                                                borderColor: 'rgb(255, 99, 132)',
                                                borderWidth: 2,
                                                label: {
                                                    enabled: true,
                                                    content: 'Peso mínimo'
                                                }

                                            },
                                            {
                                                type: 'line',
                                                mode: 'horizontal',
                                                scaleID: 'y-axis-0',
                                                value: (talla) * 24.9,
                                                borderColor: 'rgb(255,0,0)',
                                                borderWidth: 2,
                                                label: {
                                                    enabled: true,
                                                    content: 'Peso máximo aceptable'
                                                }

                                            }
                                        ]
                                    },
                                    scales: {
                                        yAxes: [
                                            {
                                                ticks: {
                                                    //fontFamily: "Roboto Mono",
                                                    //fontColor: "#556F7B",
                                                    //fontStyle: "bold",
                                                    beginAtZero: true,
                                                    //maxTicksLimit: 5,
                                                    //padding: 20
                                                },
                                                gridLines: {
                                                    //drawTicks: false,
                                                    //display: false,
                                                    //drawBorder: false
                                                }
                                            }
                                        ],
                                    }
                                }
                            });
                            break;
                        case 2:
                            userStrengthsChart = new Chart(ctx, {
                                type: 'line',
                                data: datachart,
                                options: {
                                    title: {
                                        display: true,
                                        text: "Ergometría"
                                    },
                                    /*scale: {
                                        ticks: {
                                            beginAtZero: true,
                                        }
                                    }*/
                                }
                            });
                            break;

                    }
                },
                failure: function (response) {
                    alert('Ocurrió un error.');
                },

            });
        }

    </script>

    
    <script type="text/javascript">

        $(function () {
            LoadChart2();
            /*$("#ddlGenero1", "#ddlRiesgo2", "#ddlFecha1").bind("change", function () {
                LoadChart2();
            });*/
            $("#button").on("click", function () {
                LoadChart2();
            });
            $("#rblChartType2 input").bind("click", function () {
                LoadChart2();
            });
        });
        function LoadChart2() {
            var chartType2 = parseInt($("#rblChartType2 input:checked").val());
            var ingreso = [];
            var egreso = [];
            var datachart2 = {
                labels: ["KG MUSC", "KG Grasa", "%MG", "Nivel GV", "Indice", "P.Cintura", "Peso", "Talla", "IMC"],
                datasets: [
                    {
                        label: "Ingreso",
                        backgroundColor: "rgba(90,193,208,0.3)",
                        borderColor: "rgba(151,187,205,0.7)",
                        borderWidth: 1,
                        hoverBackgroundColor: "rgba(151,187,205,1)",
                        hoverBorderColor: "rgba(151,187,205,0.5)",
                        data: ingreso
                    },
                    {
                        label: "Egreso",
                        backgroundColor: "rgba(215,220,67,0.3)",
                        borderColor: "rgba(220,220,220,0.7)",
                        borderWidth: 1,
                        hoverBackgroundColor: "rgba(220,220,220,1)",
                        hoverBorderColor: "rgba(220,220,220,0.5)",
                        data: egreso
                    }
                ]
            };
            var genero = $("#ddlGenero").val();
            var control = $("#ddlControl").val();
            var morbidos = $("#ddlMorbidos").val();
            var fecha = $("#ddlFecha").val();

            $.ajax({
                type: "POST",
                url: "/Home/AjaxMethod2",
                data: "{Genero: '" + genero + "', Control: '" + control + "', Morbidos: '" + morbidos + "', Fecha: '" + fecha + "'}",
                //data: "{Genero: '" + $("#ddlGenero").val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "text",
                success: function (response) {
                    //window.alert("H");


                    $("#dvChart2").html("");
                    $("#dvMensaje").html("");
                    //$("#dvTabla").html("");

                    //window.alert(response);
                    if (response[9] == ',') {
                        var div2 = $("<div />");
                        //div.css("font-size", "18px");
                        div2.html("<p class='caja'>No existen datos con estos parámetros</p>");
                        $("#dvMensaje").append(div2);
                    };

                    //window.alert(response[9]);

                    /*----------------------------------*/
                    var data = eval(response);

                    //var data = (eval("(" + response.d + ")"));
                    var el = document.createElement('canvas');
                    $("#dvChart2")[0].appendChild(el);

                    //window.alert("hola");
                    //window.alert(data);
                    //Fix for IE 8
                    if ($.browser.msie && $.browser.version == "8.0") {
                        G_vmlCanvasManager.initElement(el);
                    }

                    for (var i = 0; i < data.length; i++) {
                        ingreso.push(data[i].value0, data[i].value1, data[i].value2, data[i].value3, data[i].value4, data[i].value5, data[i].value6, data[i].value7, data[i].value8);
                        egreso.push(data[i].value9, data[i].value10, data[i].value11, data[i].value12, data[i].value13, data[i].value14, data[i].value15, data[i].value16, data[i].value17);
                    }


                    //console.log(ingreso);
                    //window.alert(ingreso);

                    var ctx = el.getContext('2d');
                    var userStrengthsChart;


                    switch (chartType2) {
                        case 1:
                            userStrengthsChart = new Chart(ctx, {
                                type: 'bar',
                                data: datachart2,
                                options: {
                                    title: {
                                        display: true,
                                        text: "Ergometría promedio"
                                    },
                                    scales: {
                                        yAxes: [
                                            {
                                                ticks: {
                                                    //fontFamily: "Roboto Mono",
                                                    //fontColor: "#556F7B",
                                                    //fontStyle: "bold",
                                                    beginAtZero: true,
                                                    //maxTicksLimit: 5,
                                                    //padding: 20
                                                },
                                                gridLines: {
                                                    //drawTicks: false,
                                                    //display: false,
                                                    //drawBorder: false
                                                }
                                            }
                                        ],
                                    }
                                }
                            });
                            break;
                        case 2:
                            userStrengthsChart = new Chart(ctx, {
                                type: 'line',
                                data: datachart2,
                                options: {
                                    title: {
                                        display: true,
                                        text: "Ergometría promedio"
                                    }
                                }
                            });
                            break;


                    }

                },
                failure: function (response) {
                    alert('Ocurrió un error.');
                },

            });


        }



    </script>






</body>
</html>


